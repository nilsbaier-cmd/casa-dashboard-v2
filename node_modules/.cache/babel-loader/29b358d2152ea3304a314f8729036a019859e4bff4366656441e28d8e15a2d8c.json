{"ast":null,"code":"import { Camera, Vector3, Group, Mesh, SphereGeometry, MeshBasicMaterial, Frustum, Matrix4, MeshLambertMaterial, TextureLoader, SRGBColorSpace } from 'three';\nimport { octree } from 'd3-octree';\nimport { scaleLinear } from 'd3-scale';\nimport { geoMercatorRaw } from 'd3-geo';\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(_assertClassBrand(s, a));\n}\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  _checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(_assertClassBrand(s, a), r), r;\n}\nfunction _classPrivateMethodInitSpec(e, a) {\n  _checkPrivateRedeclaration(e, a), a.add(e);\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || false, o.configurable = true, \"value\" in o && (o.writable = true), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), Object.defineProperty(e, \"prototype\", {\n    writable: false\n  }), e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }) : e[r] = t, e;\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: true,\n      configurable: true\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: false\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = true,\n      o = false;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) ;else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = true, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r);\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return String(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\nvar _materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(_materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar _deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    _materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(_deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  if (obj && obj.children) while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    _deallocate(childObj);\n  }\n};\nfunction polar2Cartesian(lat, lng, r) {\n  var phi = (90 - lat) * Math.PI / 180;\n  var theta = (90 - lng) * Math.PI / 180;\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.cos(phi),\n    z: r * Math.sin(phi) * Math.sin(theta)\n  };\n}\nfunction cartesian2Polar(_ref) {\n  var x = _ref.x,\n    y = _ref.y,\n    z = _ref.z;\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var phi = Math.acos(y / r);\n  var theta = Math.atan2(z, x);\n  return {\n    lat: 90 - phi * 180 / Math.PI,\n    lng: 90 - theta * 180 / Math.PI - (theta < -Math.PI / 2 ? 360 : 0),\n    // keep within [-180, 180] boundaries\n    r: r\n  };\n}\nfunction deg2Rad(deg) {\n  return deg * Math.PI / 180;\n}\nvar yMercatorScale = function yMercatorScale(y) {\n  return 1 - (geoMercatorRaw(0, (0.5 - y) * Math.PI)[1] / Math.PI + 1) / 2;\n};\nvar yMercatorScaleClamped = function yMercatorScaleClamped(y) {\n  return Math.max(0, Math.min(1, yMercatorScale(y)));\n};\nvar yMercatorScaleInvert = function yMercatorScaleInvert(y) {\n  return 0.5 - geoMercatorRaw.invert(0, (2 * (1 - y) - 1) * Math.PI)[1] / Math.PI;\n};\nvar convertMercatorUV = function convertMercatorUV(uvs) {\n  var y0 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var y1 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var offsetScale = scaleLinear().domain([1, 0]).range([y0, y1]).clamp(true);\n  var revOffsetScale = scaleLinear().domain([yMercatorScaleClamped(y0), yMercatorScaleClamped(y1)]).range([1, 0]).clamp(true);\n  var scale = function scale(v) {\n    return revOffsetScale(yMercatorScaleClamped(offsetScale(v)));\n  };\n  var arr = uvs.array;\n  for (var i = 0, len = arr.length; i < len; i += 2) {\n    arr[i + 1] = scale(arr[i + 1]);\n  }\n  uvs.needsUpdate = true;\n};\nvar findTileXY = function findTileXY(level, isMercator, lng, lat) {\n  var gridSize = Math.pow(2, level);\n  var x = Math.max(0, Math.min(gridSize - 1, Math.floor((lng + 180) * gridSize / 360)));\n  var relY = (90 - lat) / 180;\n  isMercator && (relY = Math.max(0, Math.min(1, yMercatorScale(relY))));\n  var y = Math.floor(relY * gridSize);\n  return [x, y];\n};\nvar genTilesCoords = function genTilesCoords(level, isMercator) {\n  var x0 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var y0 = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n  var _x1 = arguments.length > 4 ? arguments[4] : undefined;\n  var _y1 = arguments.length > 5 ? arguments[5] : undefined;\n  var tiles = [];\n  var gridSize = Math.pow(2, level);\n  var tileLngLen = 360 / gridSize;\n  var regTileLatLen = 180 / gridSize;\n  var x1 = _x1 === undefined ? gridSize - 1 : _x1;\n  var y1 = _y1 === undefined ? gridSize - 1 : _y1;\n  for (var x = x0, maxX = Math.min(gridSize - 1, x1); x <= maxX; x++) {\n    for (var y = y0, maxY = Math.min(gridSize - 1, y1); y <= maxY; y++) {\n      var reproY = y,\n        tileLatLen = regTileLatLen;\n      if (isMercator) {\n        // lat needs reprojection, but stretch to cover poles\n        reproY = y === 0 ? y : yMercatorScaleInvert(y / gridSize) * gridSize;\n        var reproYEnd = y + 1 === gridSize ? y + 1 : yMercatorScaleInvert((y + 1) / gridSize) * gridSize;\n        tileLatLen = (reproYEnd - reproY) * 180 / gridSize;\n      }\n\n      // tile centroid coordinates\n      var lng = -180 + (x + 0.5) * tileLngLen;\n      var lat = 90 - (reproY * 180 / gridSize + tileLatLen / 2);\n      var latLen = tileLatLen; // lng is always constant among all tiles\n\n      tiles.push({\n        x: x,\n        y: y,\n        lng: lng,\n        lat: lat,\n        latLen: latLen\n      });\n    }\n  }\n  return tiles;\n};\nvar MAX_LEVEL_TO_RENDER_ALL_TILES = 6; // level 6 = 4096 tiles\nvar MAX_LEVEL_TO_BUILD_LOOKUP_OCTREE = 7; // octrees consume too much memory on higher levels, generate tiles on demand for those (based on globe surface distance) as the distortion is negligible\nvar TILE_SEARCH_RADIUS_CAMERA_DISTANCE = 3; // Euclidean distance factor, in units of camera distance to surface\nvar TILE_SEARCH_RADIUS_SURFACE_DISTANCE = 90; // in degrees on the globe surface, relative to camera altitude in globe radius units\nvar _radius = /*#__PURE__*/new WeakMap();\nvar _isMercator = /*#__PURE__*/new WeakMap();\nvar _tileUrl = /*#__PURE__*/new WeakMap();\nvar _level = /*#__PURE__*/new WeakMap();\nvar _tilesMeta = /*#__PURE__*/new WeakMap();\nvar _isInView = /*#__PURE__*/new WeakMap();\nvar _camera = /*#__PURE__*/new WeakMap();\nvar _innerBackLayer = /*#__PURE__*/new WeakMap();\nvar _ThreeSlippyMapGlobe_brand = /*#__PURE__*/new WeakSet();\nvar ThreeSlippyMapGlobe = /*#__PURE__*/function (_Group) {\n  function ThreeSlippyMapGlobe(radius) {\n    var _this;\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      tileUrl = _ref.tileUrl,\n      _ref$minLevel = _ref.minLevel,\n      minLevel = _ref$minLevel === void 0 ? 0 : _ref$minLevel,\n      _ref$maxLevel = _ref.maxLevel,\n      maxLevel = _ref$maxLevel === void 0 ? 17 : _ref$maxLevel,\n      _ref$mercatorProjecti = _ref.mercatorProjection,\n      mercatorProjection = _ref$mercatorProjecti === void 0 ? true : _ref$mercatorProjecti;\n    _classCallCheck(this, ThreeSlippyMapGlobe);\n    _this = _callSuper(this, ThreeSlippyMapGlobe);\n    // Private methods\n    _classPrivateMethodInitSpec(_this, _ThreeSlippyMapGlobe_brand);\n    // Private attributes\n    _classPrivateFieldInitSpec(_this, _radius, void 0);\n    _classPrivateFieldInitSpec(_this, _isMercator, void 0);\n    _classPrivateFieldInitSpec(_this, _tileUrl, void 0);\n    _classPrivateFieldInitSpec(_this, _level, void 0);\n    _classPrivateFieldInitSpec(_this, _tilesMeta, {});\n    _classPrivateFieldInitSpec(_this, _isInView, void 0);\n    _classPrivateFieldInitSpec(_this, _camera, void 0);\n    _classPrivateFieldInitSpec(_this, _innerBackLayer, void 0);\n    _defineProperty(_this, \"minLevel\", void 0);\n    _defineProperty(_this, \"maxLevel\", void 0);\n    _defineProperty(_this, \"thresholds\", _toConsumableArray(new Array(30)).map(function (_, idx) {\n      return 8 / Math.pow(2, idx);\n    }));\n    // in terms of radius units\n    _defineProperty(_this, \"curvatureResolution\", 5);\n    // in degrees, affects number of vertices in tiles\n    _defineProperty(_this, \"tileMargin\", 0);\n    _defineProperty(_this, \"clearTiles\", function () {\n      Object.values(_classPrivateFieldGet2(_tilesMeta, _this)).forEach(function (l) {\n        l.forEach(function (d) {\n          if (d.obj) {\n            _this.remove(d.obj);\n            emptyObject(d.obj);\n            delete d.obj;\n          }\n        });\n      });\n      _classPrivateFieldSet2(_tilesMeta, _this, {});\n    });\n    _classPrivateFieldSet2(_radius, _this, radius);\n    _this.tileUrl = tileUrl;\n    _classPrivateFieldSet2(_isMercator, _this, mercatorProjection);\n    _this.minLevel = minLevel;\n    _this.maxLevel = maxLevel;\n    _this.level = 0;\n\n    // Add protective black sphere just below surface to prevent any depth buffer anomalies\n    _this.add(_classPrivateFieldSet2(_innerBackLayer, _this, new Mesh(new SphereGeometry(_classPrivateFieldGet2(_radius, _this) * 0.99, 180, 90), new MeshBasicMaterial({\n      color: 0x0\n    }))));\n    _classPrivateFieldGet2(_innerBackLayer, _this).visible = false;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffset = true;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffsetUnits = 3;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffsetFactor = 1;\n    return _this;\n  }\n  _inherits(ThreeSlippyMapGlobe, _Group);\n  return _createClass(ThreeSlippyMapGlobe, [{\n    key: \"tileUrl\",\n    get:\n    // Public attributes\n    function get() {\n      return _classPrivateFieldGet2(_tileUrl, this);\n    },\n    set: function set(tileUrl) {\n      _classPrivateFieldSet2(_tileUrl, this, tileUrl);\n      this.updatePov(_classPrivateFieldGet2(_camera, this)); // update current view\n    }\n  }, {\n    key: \"level\",\n    get: function get() {\n      return _classPrivateFieldGet2(_level, this);\n    },\n    set: function set(level) {\n      var _classPrivateFieldGet2$1,\n        _this2 = this;\n      if (!_classPrivateFieldGet2(_tilesMeta, this)[level]) _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _buildMetaLevel).call(this, level);\n      var prevLevel = _classPrivateFieldGet2(_level, this);\n      _classPrivateFieldSet2(_level, this, level);\n      if (level === prevLevel || prevLevel === undefined) return; // nothing else to do\n\n      // Activate back layer for levels > 0, when there's !depthWrite tiles\n      _classPrivateFieldGet2(_innerBackLayer, this).visible = level > 0;\n\n      // Bring layer to front\n      _classPrivateFieldGet2(_tilesMeta, this)[level].forEach(function (d) {\n        return d.obj && (d.obj.material.depthWrite = true);\n      });\n\n      // push lower layers to background\n      prevLevel < level && ((_classPrivateFieldGet2$1 = _classPrivateFieldGet2(_tilesMeta, this)[prevLevel]) === null || _classPrivateFieldGet2$1 === void 0 ? void 0 : _classPrivateFieldGet2$1.forEach(function (d) {\n        return d.obj && (d.obj.material.depthWrite = false);\n      }));\n\n      // Remove upper layers\n      if (prevLevel > level) {\n        for (var l = level + 1; l <= prevLevel; l++) {\n          _classPrivateFieldGet2(_tilesMeta, this)[l] && _classPrivateFieldGet2(_tilesMeta, this)[l].forEach(function (d) {\n            if (d.obj) {\n              _this2.remove(d.obj);\n              emptyObject(d.obj);\n              delete d.obj;\n            }\n          });\n        }\n      }\n      _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _fetchNeededTiles).call(this);\n    }\n\n    // Public methods\n  }, {\n    key: \"updatePov\",\n    value: function updatePov(camera) {\n      var _this3 = this;\n      if (!camera || !(camera instanceof Camera)) return;\n      _classPrivateFieldSet2(_camera, this, camera);\n      var frustum;\n      _classPrivateFieldSet2(_isInView, this, function (d) {\n        if (!d.hullPnts) {\n          // cached for next time to improve performance\n          var lngLen = 360 / Math.pow(2, _this3.level);\n          var lng = d.lng,\n            lat = d.lat,\n            latLen = d.latLen;\n          var lng0 = lng - lngLen / 2;\n          var lng1 = lng + lngLen / 2;\n          var lat0 = lat - latLen / 2;\n          var lat1 = lat + latLen / 2;\n          d.hullPnts = [[lat, lng], [lat0, lng0], [lat1, lng0], [lat0, lng1], [lat1, lng1]].map(function (_ref2) {\n            var _ref3 = _slicedToArray(_ref2, 2),\n              lat = _ref3[0],\n              lng = _ref3[1];\n            return polar2Cartesian(lat, lng, _classPrivateFieldGet2(_radius, _this3));\n          }).map(function (_ref4) {\n            var x = _ref4.x,\n              y = _ref4.y,\n              z = _ref4.z;\n            return new Vector3(x, y, z);\n          });\n        }\n        if (!frustum) {\n          frustum = new Frustum();\n          camera.updateMatrix();\n          camera.updateMatrixWorld();\n          frustum.setFromProjectionMatrix(new Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse));\n        }\n        return d.hullPnts.some(function (pos) {\n          return frustum.containsPoint(pos.clone().applyMatrix4(_this3.matrixWorld));\n        });\n      });\n      if (this.tileUrl) {\n        var pov = camera.position.clone();\n        var distToGlobeCenter = pov.distanceTo(this.getWorldPosition(new Vector3()));\n        var cameraDistance = (distToGlobeCenter - _classPrivateFieldGet2(_radius, this)) / _classPrivateFieldGet2(_radius, this); // in units of globe radius\n\n        var idx = this.thresholds.findIndex(function (t) {\n          return t && t <= cameraDistance;\n        });\n        this.level = Math.min(this.maxLevel, Math.max(this.minLevel, idx < 0 ? this.thresholds.length : idx));\n        _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _fetchNeededTiles).call(this);\n      }\n    }\n  }]);\n}(Group);\nfunction _buildMetaLevel(level) {\n  var _this4 = this;\n  if (level > MAX_LEVEL_TO_BUILD_LOOKUP_OCTREE) {\n    // Generate meta dynamically\n    _classPrivateFieldGet2(_tilesMeta, this)[level] = [];\n    return;\n  }\n\n  // Generate distance lookup octree\n  var levelMeta = _classPrivateFieldGet2(_tilesMeta, this)[level] = genTilesCoords(level, _classPrivateFieldGet2(_isMercator, this));\n  levelMeta.forEach(function (d) {\n    return d.centroid = polar2Cartesian(d.lat, d.lng, _classPrivateFieldGet2(_radius, _this4));\n  });\n  levelMeta.octree = octree().x(function (d) {\n    return d.centroid.x;\n  }).y(function (d) {\n    return d.centroid.y;\n  }).z(function (d) {\n    return d.centroid.z;\n  }).addAll(levelMeta);\n}\nfunction _fetchNeededTiles() {\n  var _this5 = this;\n  if (!this.tileUrl || this.level === undefined || !_classPrivateFieldGet2(_tilesMeta, this).hasOwnProperty(this.level)) return;\n\n  // Safety if can't check in view tiles for higher levels\n  if (!_classPrivateFieldGet2(_isInView, this) && this.level > MAX_LEVEL_TO_RENDER_ALL_TILES) return;\n  var tiles = _classPrivateFieldGet2(_tilesMeta, this)[this.level];\n  if (_classPrivateFieldGet2(_camera, this)) {\n    // Pre-select tiles close to the camera\n    var povPos = this.worldToLocal(_classPrivateFieldGet2(_camera, this).position.clone());\n    if (tiles.octree) {\n      var _tiles$octree;\n      // Octree based on 3d positions is more accurate\n      var _povPos = this.worldToLocal(_classPrivateFieldGet2(_camera, this).position.clone());\n      var searchRadius = (_povPos.length() - _classPrivateFieldGet2(_radius, this)) * TILE_SEARCH_RADIUS_CAMERA_DISTANCE;\n      tiles = (_tiles$octree = tiles.octree).findAllWithinRadius.apply(_tiles$octree, _toConsumableArray(_povPos).concat([searchRadius]));\n    } else {\n      // tiles populated dynamically\n      var povCoords = cartesian2Polar(povPos);\n      var searchRadiusLat = (povCoords.r / _classPrivateFieldGet2(_radius, this) - 1) * TILE_SEARCH_RADIUS_SURFACE_DISTANCE;\n      var searchRadiusLng = searchRadiusLat / Math.cos(deg2Rad(povCoords.lat)); // Distances in longitude degrees shrink towards the poles\n      var lngRange = [povCoords.lng - searchRadiusLng, povCoords.lng + searchRadiusLng];\n      var latRange = [povCoords.lat + searchRadiusLat, povCoords.lat - searchRadiusLat];\n      var _findTileXY = findTileXY(this.level, _classPrivateFieldGet2(_isMercator, this), lngRange[0], latRange[0]),\n        _findTileXY2 = _slicedToArray(_findTileXY, 2),\n        x0 = _findTileXY2[0],\n        y0 = _findTileXY2[1];\n      var _findTileXY3 = findTileXY(this.level, _classPrivateFieldGet2(_isMercator, this), lngRange[1], latRange[1]),\n        _findTileXY4 = _slicedToArray(_findTileXY3, 2),\n        x1 = _findTileXY4[0],\n        y1 = _findTileXY4[1];\n      !tiles.record && (tiles.record = {}); // Index gen tiles by XY\n      var r = tiles.record;\n      if (!r.hasOwnProperty(\"\".concat(Math.round((x0 + x1) / 2), \"_\").concat(Math.round((y0 + y1) / 2)))) {\n        // gen all found tiles if middle one is not in record\n        tiles = genTilesCoords(this.level, _classPrivateFieldGet2(_isMercator, this), x0, y0, x1, y1).map(function (d) {\n          var k = \"\".concat(d.x, \"_\").concat(d.y);\n          if (r.hasOwnProperty(k)) return r[k];\n          r[k] = d;\n          tiles.push(d);\n          return d;\n        });\n      } else {\n        // gen only those missing, one by one\n        var selTiles = [];\n        for (var x = x0; x <= x1; x++) {\n          for (var y = y0; y <= y1; y++) {\n            var k = \"\".concat(x, \"_\").concat(y);\n            if (!r.hasOwnProperty(k)) {\n              r[k] = genTilesCoords(this.level, _classPrivateFieldGet2(_isMercator, this), x, y, x, y)[0];\n              tiles.push(r[k]);\n            }\n            selTiles.push(r[k]);\n          }\n        }\n        tiles = selTiles;\n      }\n    }\n  }\n\n  /*\n  console.log({\n    level: this.level,\n    totalObjs: this.children.length,\n    tilesFound: tiles.length,\n    tilesInView: tiles.filter(this.#isInView || (() => true)).length,\n    levelTiles: this.#tilesMeta[this.level].length,\n    fetched: this.#tilesMeta[this.level].filter(d => d.obj).length,\n    loading: this.#tilesMeta[this.level].filter(d => d.loading).length,\n  });\n  */\n\n  tiles.filter(function (d) {\n    return !d.obj;\n  }).filter(_classPrivateFieldGet2(_isInView, this) || function () {\n    return true;\n  }).forEach(function (d) {\n    var x = d.x,\n      y = d.y,\n      lng = d.lng,\n      lat = d.lat,\n      latLen = d.latLen;\n    var lngLen = 360 / Math.pow(2, _this5.level);\n    if (!d.obj) {\n      var width = lngLen * (1 - _this5.tileMargin);\n      var height = latLen * (1 - _this5.tileMargin);\n      var rotLng = deg2Rad(lng);\n      var rotLat = deg2Rad(-lat);\n      var tile = new Mesh(new SphereGeometry(_classPrivateFieldGet2(_radius, _this5), Math.ceil(width / _this5.curvatureResolution), Math.ceil(height / _this5.curvatureResolution), deg2Rad(90 - width / 2) + rotLng, deg2Rad(width), deg2Rad(90 - height / 2) + rotLat, deg2Rad(height)), new MeshLambertMaterial());\n      if (_classPrivateFieldGet2(_isMercator, _this5)) {\n        var _map = [lat + latLen / 2, lat - latLen / 2].map(function (lat) {\n            return 0.5 - lat / 180;\n          }),\n          _map2 = _slicedToArray(_map, 2),\n          _y = _map2[0],\n          _y2 = _map2[1];\n        convertMercatorUV(tile.geometry.attributes.uv, _y, _y2);\n      }\n      d.obj = tile;\n    }\n    if (!d.loading) {\n      d.loading = true;\n\n      // Fetch tile image\n      new TextureLoader().load(_this5.tileUrl(x, y, _this5.level), function (texture) {\n        var tile = d.obj;\n        if (tile) {\n          texture.colorSpace = SRGBColorSpace;\n          tile.material.map = texture;\n          tile.material.color = null;\n          tile.material.needsUpdate = true;\n          _this5.add(tile);\n        }\n        d.loading = false;\n      });\n    }\n  });\n}\nexport { ThreeSlippyMapGlobe as default };","map":{"version":3,"names":["Camera","Vector3","Group","Mesh","SphereGeometry","MeshBasicMaterial","Frustum","Matrix4","MeshLambertMaterial","TextureLoader","SRGBColorSpace","octree","scaleLinear","geoMercatorRaw","_arrayLikeToArray","r","a","length","e","n","Array","_arrayWithHoles","isArray","_arrayWithoutHoles","_assertClassBrand","t","has","arguments","TypeError","_assertThisInitialized","ReferenceError","_callSuper","o","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_checkPrivateRedeclaration","_classCallCheck","_classPrivateFieldGet2","s","get","_classPrivateFieldInitSpec","set","_classPrivateFieldSet2","_classPrivateMethodInitSpec","add","_defineProperties","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","_defineProperty","value","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","_setPrototypeOf","Boolean","valueOf","call","_iterableToArray","Symbol","iterator","from","_iterableToArrayLimit","l","i","u","f","next","done","push","return","_nonIterableRest","_nonIterableSpread","_slicedToArray","_unsupportedIterableToArray","_toConsumableArray","_toPrimitive","toPrimitive","String","toString","slice","name","test","_materialDispose","materialDispose","material","forEach","map","dispose","_deallocate","deallocate","obj","geometry","texture","children","emptyObject","childObj","remove","polar2Cartesian","lat","lng","phi","Math","PI","theta","x","sin","cos","y","z","cartesian2Polar","_ref","sqrt","acos","atan2","deg2Rad","deg","yMercatorScale","yMercatorScaleClamped","max","min","yMercatorScaleInvert","invert","convertMercatorUV","uvs","y0","undefined","y1","offsetScale","domain","range","clamp","revOffsetScale","scale","v","arr","array","len","needsUpdate","findTileXY","level","isMercator","gridSize","pow","floor","relY","genTilesCoords","x0","_x1","_y1","tiles","tileLngLen","regTileLatLen","x1","maxX","maxY","reproY","tileLatLen","reproYEnd","latLen","MAX_LEVEL_TO_RENDER_ALL_TILES","MAX_LEVEL_TO_BUILD_LOOKUP_OCTREE","TILE_SEARCH_RADIUS_CAMERA_DISTANCE","TILE_SEARCH_RADIUS_SURFACE_DISTANCE","_radius","WeakMap","_isMercator","_tileUrl","_level","_tilesMeta","_isInView","_camera","_innerBackLayer","_ThreeSlippyMapGlobe_brand","WeakSet","ThreeSlippyMapGlobe","_Group","radius","_this","tileUrl","_ref$minLevel","minLevel","_ref$maxLevel","maxLevel","_ref$mercatorProjecti","mercatorProjection","_","idx","values","d","color","visible","polygonOffset","polygonOffsetUnits","polygonOffsetFactor","updatePov","_classPrivateFieldGet2$1","_this2","_buildMetaLevel","prevLevel","depthWrite","_fetchNeededTiles","camera","_this3","frustum","hullPnts","lngLen","lng0","lng1","lat0","lat1","_ref2","_ref3","_ref4","updateMatrix","updateMatrixWorld","setFromProjectionMatrix","multiplyMatrices","projectionMatrix","matrixWorldInverse","some","pos","containsPoint","clone","applyMatrix4","matrixWorld","pov","position","distToGlobeCenter","distanceTo","getWorldPosition","cameraDistance","thresholds","findIndex","_this4","levelMeta","centroid","addAll","_this5","hasOwnProperty","povPos","worldToLocal","_tiles$octree","_povPos","searchRadius","findAllWithinRadius","concat","povCoords","searchRadiusLat","searchRadiusLng","lngRange","latRange","_findTileXY","_findTileXY2","_findTileXY3","_findTileXY4","record","round","k","selTiles","filter","width","tileMargin","height","rotLng","rotLat","tile","ceil","curvatureResolution","_map","_map2","_y","_y2","attributes","uv","loading","load","colorSpace","default"],"sources":["/Users/Nils_1/Downloads/casa-react-v2/node_modules/globe.gl/node_modules/three-slippy-map-globe/dist/three-slippy-map-globe.mjs"],"sourcesContent":["import { Camera, Vector3, Group, Mesh, SphereGeometry, MeshBasicMaterial, Frustum, Matrix4, MeshLambertMaterial, TextureLoader, SRGBColorSpace } from 'three';\nimport { octree } from 'd3-octree';\nimport { scaleLinear } from 'd3-scale';\nimport { geoMercatorRaw } from 'd3-geo';\n\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(_assertClassBrand(s, a));\n}\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  _checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(_assertClassBrand(s, a), r), r;\n}\nfunction _classPrivateMethodInitSpec(e, a) {\n  _checkPrivateRedeclaration(e, a), a.add(e);\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || false, o.configurable = true, \"value\" in o && (o.writable = true), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), Object.defineProperty(e, \"prototype\", {\n    writable: false\n  }), e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }) : e[r] = t, e;\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: true,\n      configurable: true\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: false\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = true,\n      o = false;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) ; else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = true, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r);\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (String )(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nvar _materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(_materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar _deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    _materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(_deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  if (obj && obj.children) while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    _deallocate(childObj);\n  }\n};\n\nfunction polar2Cartesian(lat, lng, r) {\n  var phi = (90 - lat) * Math.PI / 180;\n  var theta = (90 - lng) * Math.PI / 180;\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.cos(phi),\n    z: r * Math.sin(phi) * Math.sin(theta)\n  };\n}\nfunction cartesian2Polar(_ref) {\n  var x = _ref.x,\n    y = _ref.y,\n    z = _ref.z;\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var phi = Math.acos(y / r);\n  var theta = Math.atan2(z, x);\n  return {\n    lat: 90 - phi * 180 / Math.PI,\n    lng: 90 - theta * 180 / Math.PI - (theta < -Math.PI / 2 ? 360 : 0),\n    // keep within [-180, 180] boundaries\n    r: r\n  };\n}\nfunction deg2Rad(deg) {\n  return deg * Math.PI / 180;\n}\n\nvar yMercatorScale = function yMercatorScale(y) {\n  return 1 - (geoMercatorRaw(0, (0.5 - y) * Math.PI)[1] / Math.PI + 1) / 2;\n};\nvar yMercatorScaleClamped = function yMercatorScaleClamped(y) {\n  return Math.max(0, Math.min(1, yMercatorScale(y)));\n};\nvar yMercatorScaleInvert = function yMercatorScaleInvert(y) {\n  return 0.5 - geoMercatorRaw.invert(0, (2 * (1 - y) - 1) * Math.PI)[1] / Math.PI;\n};\nvar convertMercatorUV = function convertMercatorUV(uvs) {\n  var y0 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var y1 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var offsetScale = scaleLinear().domain([1, 0]).range([y0, y1]).clamp(true);\n  var revOffsetScale = scaleLinear().domain([yMercatorScaleClamped(y0), yMercatorScaleClamped(y1)]).range([1, 0]).clamp(true);\n  var scale = function scale(v) {\n    return revOffsetScale(yMercatorScaleClamped(offsetScale(v)));\n  };\n  var arr = uvs.array;\n  for (var i = 0, len = arr.length; i < len; i += 2) {\n    arr[i + 1] = scale(arr[i + 1]);\n  }\n  uvs.needsUpdate = true;\n};\n\nvar findTileXY = function findTileXY(level, isMercator, lng, lat) {\n  var gridSize = Math.pow(2, level);\n  var x = Math.max(0, Math.min(gridSize - 1, Math.floor((lng + 180) * gridSize / 360)));\n  var relY = (90 - lat) / 180;\n  isMercator && (relY = Math.max(0, Math.min(1, yMercatorScale(relY))));\n  var y = Math.floor(relY * gridSize);\n  return [x, y];\n};\nvar genTilesCoords = function genTilesCoords(level, isMercator) {\n  var x0 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var y0 = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n  var _x1 = arguments.length > 4 ? arguments[4] : undefined;\n  var _y1 = arguments.length > 5 ? arguments[5] : undefined;\n  var tiles = [];\n  var gridSize = Math.pow(2, level);\n  var tileLngLen = 360 / gridSize;\n  var regTileLatLen = 180 / gridSize;\n  var x1 = _x1 === undefined ? gridSize - 1 : _x1;\n  var y1 = _y1 === undefined ? gridSize - 1 : _y1;\n  for (var x = x0, maxX = Math.min(gridSize - 1, x1); x <= maxX; x++) {\n    for (var y = y0, maxY = Math.min(gridSize - 1, y1); y <= maxY; y++) {\n      var reproY = y,\n        tileLatLen = regTileLatLen;\n      if (isMercator) {\n        // lat needs reprojection, but stretch to cover poles\n        reproY = y === 0 ? y : yMercatorScaleInvert(y / gridSize) * gridSize;\n        var reproYEnd = y + 1 === gridSize ? y + 1 : yMercatorScaleInvert((y + 1) / gridSize) * gridSize;\n        tileLatLen = (reproYEnd - reproY) * 180 / gridSize;\n      }\n\n      // tile centroid coordinates\n      var lng = -180 + (x + 0.5) * tileLngLen;\n      var lat = 90 - (reproY * 180 / gridSize + tileLatLen / 2);\n      var latLen = tileLatLen; // lng is always constant among all tiles\n\n      tiles.push({\n        x: x,\n        y: y,\n        lng: lng,\n        lat: lat,\n        latLen: latLen\n      });\n    }\n  }\n  return tiles;\n};\n\nvar MAX_LEVEL_TO_RENDER_ALL_TILES = 6; // level 6 = 4096 tiles\nvar MAX_LEVEL_TO_BUILD_LOOKUP_OCTREE = 7; // octrees consume too much memory on higher levels, generate tiles on demand for those (based on globe surface distance) as the distortion is negligible\nvar TILE_SEARCH_RADIUS_CAMERA_DISTANCE = 3; // Euclidean distance factor, in units of camera distance to surface\nvar TILE_SEARCH_RADIUS_SURFACE_DISTANCE = 90; // in degrees on the globe surface, relative to camera altitude in globe radius units\nvar _radius = /*#__PURE__*/new WeakMap();\nvar _isMercator = /*#__PURE__*/new WeakMap();\nvar _tileUrl = /*#__PURE__*/new WeakMap();\nvar _level = /*#__PURE__*/new WeakMap();\nvar _tilesMeta = /*#__PURE__*/new WeakMap();\nvar _isInView = /*#__PURE__*/new WeakMap();\nvar _camera = /*#__PURE__*/new WeakMap();\nvar _innerBackLayer = /*#__PURE__*/new WeakMap();\nvar _ThreeSlippyMapGlobe_brand = /*#__PURE__*/new WeakSet();\nvar ThreeSlippyMapGlobe = /*#__PURE__*/function (_Group) {\n  function ThreeSlippyMapGlobe(radius) {\n    var _this;\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      tileUrl = _ref.tileUrl,\n      _ref$minLevel = _ref.minLevel,\n      minLevel = _ref$minLevel === void 0 ? 0 : _ref$minLevel,\n      _ref$maxLevel = _ref.maxLevel,\n      maxLevel = _ref$maxLevel === void 0 ? 17 : _ref$maxLevel,\n      _ref$mercatorProjecti = _ref.mercatorProjection,\n      mercatorProjection = _ref$mercatorProjecti === void 0 ? true : _ref$mercatorProjecti;\n    _classCallCheck(this, ThreeSlippyMapGlobe);\n    _this = _callSuper(this, ThreeSlippyMapGlobe);\n    // Private methods\n    _classPrivateMethodInitSpec(_this, _ThreeSlippyMapGlobe_brand);\n    // Private attributes\n    _classPrivateFieldInitSpec(_this, _radius, void 0);\n    _classPrivateFieldInitSpec(_this, _isMercator, void 0);\n    _classPrivateFieldInitSpec(_this, _tileUrl, void 0);\n    _classPrivateFieldInitSpec(_this, _level, void 0);\n    _classPrivateFieldInitSpec(_this, _tilesMeta, {});\n    _classPrivateFieldInitSpec(_this, _isInView, void 0);\n    _classPrivateFieldInitSpec(_this, _camera, void 0);\n    _classPrivateFieldInitSpec(_this, _innerBackLayer, void 0);\n    _defineProperty(_this, \"minLevel\", void 0);\n    _defineProperty(_this, \"maxLevel\", void 0);\n    _defineProperty(_this, \"thresholds\", _toConsumableArray(new Array(30)).map(function (_, idx) {\n      return 8 / Math.pow(2, idx);\n    }));\n    // in terms of radius units\n    _defineProperty(_this, \"curvatureResolution\", 5);\n    // in degrees, affects number of vertices in tiles\n    _defineProperty(_this, \"tileMargin\", 0);\n    _defineProperty(_this, \"clearTiles\", function () {\n      Object.values(_classPrivateFieldGet2(_tilesMeta, _this)).forEach(function (l) {\n        l.forEach(function (d) {\n          if (d.obj) {\n            _this.remove(d.obj);\n            emptyObject(d.obj);\n            delete d.obj;\n          }\n        });\n      });\n      _classPrivateFieldSet2(_tilesMeta, _this, {});\n    });\n    _classPrivateFieldSet2(_radius, _this, radius);\n    _this.tileUrl = tileUrl;\n    _classPrivateFieldSet2(_isMercator, _this, mercatorProjection);\n    _this.minLevel = minLevel;\n    _this.maxLevel = maxLevel;\n    _this.level = 0;\n\n    // Add protective black sphere just below surface to prevent any depth buffer anomalies\n    _this.add(_classPrivateFieldSet2(_innerBackLayer, _this, new Mesh(new SphereGeometry(_classPrivateFieldGet2(_radius, _this) * 0.99, 180, 90), new MeshBasicMaterial({\n      color: 0x0\n    }))));\n    _classPrivateFieldGet2(_innerBackLayer, _this).visible = false;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffset = true;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffsetUnits = 3;\n    _classPrivateFieldGet2(_innerBackLayer, _this).material.polygonOffsetFactor = 1;\n    return _this;\n  }\n  _inherits(ThreeSlippyMapGlobe, _Group);\n  return _createClass(ThreeSlippyMapGlobe, [{\n    key: \"tileUrl\",\n    get:\n    // Public attributes\n    function get() {\n      return _classPrivateFieldGet2(_tileUrl, this);\n    },\n    set: function set(tileUrl) {\n      _classPrivateFieldSet2(_tileUrl, this, tileUrl);\n      this.updatePov(_classPrivateFieldGet2(_camera, this)); // update current view\n    }\n  }, {\n    key: \"level\",\n    get: function get() {\n      return _classPrivateFieldGet2(_level, this);\n    },\n    set: function set(level) {\n      var _classPrivateFieldGet2$1,\n        _this2 = this;\n      if (!_classPrivateFieldGet2(_tilesMeta, this)[level]) _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _buildMetaLevel).call(this, level);\n      var prevLevel = _classPrivateFieldGet2(_level, this);\n      _classPrivateFieldSet2(_level, this, level);\n      if (level === prevLevel || prevLevel === undefined) return; // nothing else to do\n\n      // Activate back layer for levels > 0, when there's !depthWrite tiles\n      _classPrivateFieldGet2(_innerBackLayer, this).visible = level > 0;\n\n      // Bring layer to front\n      _classPrivateFieldGet2(_tilesMeta, this)[level].forEach(function (d) {\n        return d.obj && (d.obj.material.depthWrite = true);\n      });\n\n      // push lower layers to background\n      prevLevel < level && ((_classPrivateFieldGet2$1 = _classPrivateFieldGet2(_tilesMeta, this)[prevLevel]) === null || _classPrivateFieldGet2$1 === void 0 ? void 0 : _classPrivateFieldGet2$1.forEach(function (d) {\n        return d.obj && (d.obj.material.depthWrite = false);\n      }));\n\n      // Remove upper layers\n      if (prevLevel > level) {\n        for (var l = level + 1; l <= prevLevel; l++) {\n          _classPrivateFieldGet2(_tilesMeta, this)[l] && _classPrivateFieldGet2(_tilesMeta, this)[l].forEach(function (d) {\n            if (d.obj) {\n              _this2.remove(d.obj);\n              emptyObject(d.obj);\n              delete d.obj;\n            }\n          });\n        }\n      }\n      _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _fetchNeededTiles).call(this);\n    }\n\n    // Public methods\n  }, {\n    key: \"updatePov\",\n    value: function updatePov(camera) {\n      var _this3 = this;\n      if (!camera || !(camera instanceof Camera)) return;\n      _classPrivateFieldSet2(_camera, this, camera);\n      var frustum;\n      _classPrivateFieldSet2(_isInView, this, function (d) {\n        if (!d.hullPnts) {\n          // cached for next time to improve performance\n          var lngLen = 360 / Math.pow(2, _this3.level);\n          var lng = d.lng,\n            lat = d.lat,\n            latLen = d.latLen;\n          var lng0 = lng - lngLen / 2;\n          var lng1 = lng + lngLen / 2;\n          var lat0 = lat - latLen / 2;\n          var lat1 = lat + latLen / 2;\n          d.hullPnts = [[lat, lng], [lat0, lng0], [lat1, lng0], [lat0, lng1], [lat1, lng1]].map(function (_ref2) {\n            var _ref3 = _slicedToArray(_ref2, 2),\n              lat = _ref3[0],\n              lng = _ref3[1];\n            return polar2Cartesian(lat, lng, _classPrivateFieldGet2(_radius, _this3));\n          }).map(function (_ref4) {\n            var x = _ref4.x,\n              y = _ref4.y,\n              z = _ref4.z;\n            return new Vector3(x, y, z);\n          });\n        }\n        if (!frustum) {\n          frustum = new Frustum();\n          camera.updateMatrix();\n          camera.updateMatrixWorld();\n          frustum.setFromProjectionMatrix(new Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse));\n        }\n        return d.hullPnts.some(function (pos) {\n          return frustum.containsPoint(pos.clone().applyMatrix4(_this3.matrixWorld));\n        });\n      });\n      if (this.tileUrl) {\n        var pov = camera.position.clone();\n        var distToGlobeCenter = pov.distanceTo(this.getWorldPosition(new Vector3()));\n        var cameraDistance = (distToGlobeCenter - _classPrivateFieldGet2(_radius, this)) / _classPrivateFieldGet2(_radius, this); // in units of globe radius\n\n        var idx = this.thresholds.findIndex(function (t) {\n          return t && t <= cameraDistance;\n        });\n        this.level = Math.min(this.maxLevel, Math.max(this.minLevel, idx < 0 ? this.thresholds.length : idx));\n        _assertClassBrand(_ThreeSlippyMapGlobe_brand, this, _fetchNeededTiles).call(this);\n      }\n    }\n  }]);\n}(Group);\nfunction _buildMetaLevel(level) {\n  var _this4 = this;\n  if (level > MAX_LEVEL_TO_BUILD_LOOKUP_OCTREE) {\n    // Generate meta dynamically\n    _classPrivateFieldGet2(_tilesMeta, this)[level] = [];\n    return;\n  }\n\n  // Generate distance lookup octree\n  var levelMeta = _classPrivateFieldGet2(_tilesMeta, this)[level] = genTilesCoords(level, _classPrivateFieldGet2(_isMercator, this));\n  levelMeta.forEach(function (d) {\n    return d.centroid = polar2Cartesian(d.lat, d.lng, _classPrivateFieldGet2(_radius, _this4));\n  });\n  levelMeta.octree = octree().x(function (d) {\n    return d.centroid.x;\n  }).y(function (d) {\n    return d.centroid.y;\n  }).z(function (d) {\n    return d.centroid.z;\n  }).addAll(levelMeta);\n}\nfunction _fetchNeededTiles() {\n  var _this5 = this;\n  if (!this.tileUrl || this.level === undefined || !_classPrivateFieldGet2(_tilesMeta, this).hasOwnProperty(this.level)) return;\n\n  // Safety if can't check in view tiles for higher levels\n  if (!_classPrivateFieldGet2(_isInView, this) && this.level > MAX_LEVEL_TO_RENDER_ALL_TILES) return;\n  var tiles = _classPrivateFieldGet2(_tilesMeta, this)[this.level];\n  if (_classPrivateFieldGet2(_camera, this)) {\n    // Pre-select tiles close to the camera\n    var povPos = this.worldToLocal(_classPrivateFieldGet2(_camera, this).position.clone());\n    if (tiles.octree) {\n      var _tiles$octree;\n      // Octree based on 3d positions is more accurate\n      var _povPos = this.worldToLocal(_classPrivateFieldGet2(_camera, this).position.clone());\n      var searchRadius = (_povPos.length() - _classPrivateFieldGet2(_radius, this)) * TILE_SEARCH_RADIUS_CAMERA_DISTANCE;\n      tiles = (_tiles$octree = tiles.octree).findAllWithinRadius.apply(_tiles$octree, _toConsumableArray(_povPos).concat([searchRadius]));\n    } else {\n      // tiles populated dynamically\n      var povCoords = cartesian2Polar(povPos);\n      var searchRadiusLat = (povCoords.r / _classPrivateFieldGet2(_radius, this) - 1) * TILE_SEARCH_RADIUS_SURFACE_DISTANCE;\n      var searchRadiusLng = searchRadiusLat / Math.cos(deg2Rad(povCoords.lat)); // Distances in longitude degrees shrink towards the poles\n      var lngRange = [povCoords.lng - searchRadiusLng, povCoords.lng + searchRadiusLng];\n      var latRange = [povCoords.lat + searchRadiusLat, povCoords.lat - searchRadiusLat];\n      var _findTileXY = findTileXY(this.level, _classPrivateFieldGet2(_isMercator, this), lngRange[0], latRange[0]),\n        _findTileXY2 = _slicedToArray(_findTileXY, 2),\n        x0 = _findTileXY2[0],\n        y0 = _findTileXY2[1];\n      var _findTileXY3 = findTileXY(this.level, _classPrivateFieldGet2(_isMercator, this), lngRange[1], latRange[1]),\n        _findTileXY4 = _slicedToArray(_findTileXY3, 2),\n        x1 = _findTileXY4[0],\n        y1 = _findTileXY4[1];\n      !tiles.record && (tiles.record = {}); // Index gen tiles by XY\n      var r = tiles.record;\n      if (!r.hasOwnProperty(\"\".concat(Math.round((x0 + x1) / 2), \"_\").concat(Math.round((y0 + y1) / 2)))) {\n        // gen all found tiles if middle one is not in record\n        tiles = genTilesCoords(this.level, _classPrivateFieldGet2(_isMercator, this), x0, y0, x1, y1).map(function (d) {\n          var k = \"\".concat(d.x, \"_\").concat(d.y);\n          if (r.hasOwnProperty(k)) return r[k];\n          r[k] = d;\n          tiles.push(d);\n          return d;\n        });\n      } else {\n        // gen only those missing, one by one\n        var selTiles = [];\n        for (var x = x0; x <= x1; x++) {\n          for (var y = y0; y <= y1; y++) {\n            var k = \"\".concat(x, \"_\").concat(y);\n            if (!r.hasOwnProperty(k)) {\n              r[k] = genTilesCoords(this.level, _classPrivateFieldGet2(_isMercator, this), x, y, x, y)[0];\n              tiles.push(r[k]);\n            }\n            selTiles.push(r[k]);\n          }\n        }\n        tiles = selTiles;\n      }\n    }\n  }\n\n  /*\n  console.log({\n    level: this.level,\n    totalObjs: this.children.length,\n    tilesFound: tiles.length,\n    tilesInView: tiles.filter(this.#isInView || (() => true)).length,\n    levelTiles: this.#tilesMeta[this.level].length,\n    fetched: this.#tilesMeta[this.level].filter(d => d.obj).length,\n    loading: this.#tilesMeta[this.level].filter(d => d.loading).length,\n  });\n  */\n\n  tiles.filter(function (d) {\n    return !d.obj;\n  }).filter(_classPrivateFieldGet2(_isInView, this) || function () {\n    return true;\n  }).forEach(function (d) {\n    var x = d.x,\n      y = d.y,\n      lng = d.lng,\n      lat = d.lat,\n      latLen = d.latLen;\n    var lngLen = 360 / Math.pow(2, _this5.level);\n    if (!d.obj) {\n      var width = lngLen * (1 - _this5.tileMargin);\n      var height = latLen * (1 - _this5.tileMargin);\n      var rotLng = deg2Rad(lng);\n      var rotLat = deg2Rad(-lat);\n      var tile = new Mesh(new SphereGeometry(_classPrivateFieldGet2(_radius, _this5), Math.ceil(width / _this5.curvatureResolution), Math.ceil(height / _this5.curvatureResolution), deg2Rad(90 - width / 2) + rotLng, deg2Rad(width), deg2Rad(90 - height / 2) + rotLat, deg2Rad(height)), new MeshLambertMaterial());\n      if (_classPrivateFieldGet2(_isMercator, _this5)) {\n        var _map = [lat + latLen / 2, lat - latLen / 2].map(function (lat) {\n            return 0.5 - lat / 180;\n          }),\n          _map2 = _slicedToArray(_map, 2),\n          _y = _map2[0],\n          _y2 = _map2[1];\n        convertMercatorUV(tile.geometry.attributes.uv, _y, _y2);\n      }\n      d.obj = tile;\n    }\n    if (!d.loading) {\n      d.loading = true;\n\n      // Fetch tile image\n      new TextureLoader().load(_this5.tileUrl(x, y, _this5.level), function (texture) {\n        var tile = d.obj;\n        if (tile) {\n          texture.colorSpace = SRGBColorSpace;\n          tile.material.map = texture;\n          tile.material.color = null;\n          tile.material.needsUpdate = true;\n          _this5.add(tile);\n        }\n        d.loading = false;\n      });\n    }\n  });\n}\n\nexport { ThreeSlippyMapGlobe as default };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}